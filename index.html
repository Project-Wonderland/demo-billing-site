<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dress Shop Billing System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .status-paid { background: linear-gradient(135deg, #10b981, #059669); }
        .status-pending { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .status-excess { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-full">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-purple-800 mb-2">Elegant Dress Shop</h1>
            <p class="text-gray-600">Billing & Invoice Management System</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg shadow-lg p-1 flex">
                <button id="searchTab" class="px-6 py-3 rounded-md font-medium transition-all bg-purple-600 text-white">
                    Search Invoices
                </button>
                <button id="newInvoiceTab" class="px-6 py-3 rounded-md font-medium transition-all text-purple-600 hover:bg-purple-50">
                    New Invoice
                </button>
                <button id="reportsTab" class="px-6 py-3 rounded-md font-medium transition-all text-purple-600 hover:bg-purple-50">
                    Reports
                </button>
            </div>
        </div>

        <!-- Search Section -->
        <div id="searchSection" class="fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Search Invoices & History</h2>
                <div class="grid md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label for="billNoSearch" class="block text-sm font-medium text-gray-700 mb-2">Bill Number</label>
                        <input type="text" id="billNoSearch" placeholder="Enter bill number" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="customerNameSearch" class="block text-sm font-medium text-gray-700 mb-2">Customer Name</label>
                        <input type="text" id="customerNameSearch" placeholder="Enter customer name" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="phoneSearch" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="text" id="phoneSearch" placeholder="Enter phone number" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                </div>
                <div class="flex gap-4">
                    <button onclick="searchInvoices()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                        Search
                    </button>
                    <button onclick="showAllInvoices()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                        Show All Invoices
                    </button>
                </div>
            </div>

            <!-- Search Results -->
            <div id="searchResults" class="hidden bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Invoice Results</h3>
                <div id="searchResultsList"></div>
            </div>
        </div>

        <!-- New Invoice Section -->
        <div id="newInvoiceSection" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Create New Invoice</h2>
                </div>

                <!-- Invoice Type -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Invoice Type</label>
                    <div class="flex gap-6">
                        <div class="flex items-center">
                            <input type="radio" id="typePurchase" name="invoiceType" value="purchase" class="mr-2" checked>
                            <label for="typePurchase" class="text-sm text-gray-700">Purchase (Immediate)</label>
                        </div>
                        <div class="flex items-center">
                            <input type="radio" id="typeOrder" name="invoiceType" value="order" class="mr-2">
                            <label for="typeOrder" class="text-sm text-gray-700">Order (To be prepared)</label>
                        </div>
                    </div>
                </div>

                <!-- Customer Details -->
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="customerName" class="block text-sm font-medium text-gray-700 mb-2">Customer Name</label>
                        <input type="text" id="customerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="customerPhone" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="text" id="customerPhone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                </div>

                <!-- Items Section -->
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Items</h3>
                        <button onclick="addItem()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            Add Item
                        </button>
                    </div>
                    <div id="itemsList">
                        <div class="grid grid-cols-12 gap-2 mb-2 text-sm font-medium text-gray-600">
                            <div class="col-span-4">Item Description</div>
                            <div class="col-span-2">Quantity</div>
                            <div class="col-span-2">Price</div>
                            <div class="col-span-2">Total</div>
                            <div class="col-span-2">Action</div>
                        </div>
                        <div class="item-row grid grid-cols-12 gap-2 mb-2">
                            <input type="text" placeholder="Dress description" class="col-span-4 px-3 py-2 border border-gray-300 rounded-lg item-desc">
                            <input type="number" placeholder="1" class="col-span-2 px-3 py-2 border border-gray-300 rounded-lg item-qty" value="1" onchange="calculateItemTotal(this)">
                            <input type="number" placeholder="0.00" class="col-span-2 px-3 py-2 border border-gray-300 rounded-lg item-price" onchange="calculateItemTotal(this)">
                            <input type="number" class="col-span-2 px-3 py-2 border border-gray-300 rounded-lg item-total bg-gray-50" readonly>
                            <button onclick="removeItem(this)" class="col-span-2 bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors">Remove</button>
                        </div>
                    </div>
                </div>

                <!-- Payment Details -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label for="subtotal" class="block text-sm font-medium text-gray-700 mb-2">Subtotal</label>
                        <input type="number" id="subtotal" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                    <div>
                        <label for="amountPaid" class="block text-sm font-medium text-gray-700 mb-2">Amount Paid</label>
                        <input type="number" id="amountPaid" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" onchange="calculateBalance()">
                    </div>
                    <div>
                        <label for="balance" class="block text-sm font-medium text-gray-700 mb-2">Balance</label>
                        <input type="number" id="balance" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button onclick="saveInvoice()" class="bg-purple-600 text-white px-8 py-3 rounded-lg hover:bg-purple-700 transition-colors font-medium">
                        Save Invoice
                    </button>
                    <button onclick="saveAndPrintInvoice()" class="bg-green-600 text-white px-8 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium">
                        Save & Print
                    </button>
                </div>
            </div>
        </div>



        <!-- Reports Section -->
        <div id="reportsSection" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Business Reports</h2>
                
                <!-- Date Range Filter -->
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label for="startDate" class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                        <input type="date" id="startDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label for="endDate" class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                        <input type="date" id="endDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div class="flex items-end">
                        <button onclick="generateReport()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            Generate Report
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div id="reportSummary" class="grid md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">
                        <h3 class="text-sm font-medium opacity-90">Total Sales</h3>
                        <p id="totalSales" class="text-2xl font-bold">â‚¹0.00</p>
                    </div>
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg">
                        <h3 class="text-sm font-medium opacity-90">Total Invoices</h3>
                        <p id="totalInvoices" class="text-2xl font-bold">0</p>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-lg">
                        <h3 class="text-sm font-medium opacity-90">Pending Amount</h3>
                        <p id="pendingAmount" class="text-2xl font-bold">â‚¹0.00</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg">
                        <h3 class="text-sm font-medium opacity-90">Avg Invoice Value</h3>
                        <p id="avgInvoice" class="text-2xl font-bold">â‚¹0.00</p>
                    </div>
                </div>

                <!-- Detailed Report Table -->
                <div id="reportDetails" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-800">Detailed Report</h3>
                        <button onclick="printReport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            Print Report
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Invoice ID</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Date</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Customer</th>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Phone</th>
                                    <th class="border border-gray-300 px-4 py-2 text-right">Amount</th>
                                    <th class="border border-gray-300 px-4 py-2 text-right">Paid</th>
                                    <th class="border border-gray-300 px-4 py-2 text-right">Balance</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invoice Details Popup Modal -->
        <div id="invoiceModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-full overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Invoice Details</h2>
                        <button onclick="closeInvoiceModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">Ã—</button>
                    </div>
                    <div id="invoiceModalContent"></div>
                    <div class="flex gap-4 mt-6">
                        <button onclick="printCurrentInvoice()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors">
                            Print Invoice
                        </button>
                        <button onclick="closeInvoiceModal()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Sample data
        let invoices = [
            {
                id: 'INV001',
                customerName: 'Sarah Johnson',
                phone: '555-0123',
                date: '2024-01-15',
                type: 'purchase',
                items: [
                    { desc: 'Evening Gown - Black', qty: 1, price: 24999.00, total: 24999.00 },
                    { desc: 'Silk Scarf', qty: 2, price: 4000.00, total: 8000.00 }
                ],
                subtotal: 32999.00,
                amountPaid: 32999.00,
                balance: 0,
                status: 'paid'
            },
            {
                id: 'INV002',
                customerName: 'Emily Davis',
                phone: '555-0456',
                date: '2024-01-16',
                type: 'order',
                orderStatus: 'pending',
                items: [
                    { desc: 'Wedding Dress - White', qty: 1, price: 74999.00, total: 74999.00 }
                ],
                subtotal: 74999.00,
                amountPaid: 40000.00,
                balance: 34999.00,
                status: 'pending'
            },
            {
                id: 'INV003',
                customerName: 'Jessica Wilson',
                phone: '555-0789',
                date: '2024-01-17',
                type: 'order',
                orderStatus: 'ready',
                items: [
                    { desc: 'Cocktail Dress - Red', qty: 1, price: 16999.00, total: 16999.00 }
                ],
                subtotal: 16999.00,
                amountPaid: 20000.00,
                balance: -3001.00,
                status: 'excess'
            }
        ];

        let currentInvoiceId = 4;

        // Tab switching
        document.getElementById('searchTab').addEventListener('click', () => switchTab('search'));
        document.getElementById('newInvoiceTab').addEventListener('click', () => switchTab('newInvoice'));
        document.getElementById('reportsTab').addEventListener('click', () => switchTab('reports'));

        function switchTab(tab) {
            // Hide all sections
            document.getElementById('searchSection').classList.add('hidden');
            document.getElementById('newInvoiceSection').classList.add('hidden');
            document.getElementById('reportsSection').classList.add('hidden');

            // Reset tab styles
            document.querySelectorAll('button[id$="Tab"]').forEach(btn => {
                btn.classList.remove('bg-purple-600', 'text-white');
                btn.classList.add('text-purple-600');
            });

            // Show selected section and update tab
            if (tab === 'search') {
                document.getElementById('searchSection').classList.remove('hidden');
                document.getElementById('searchTab').classList.add('bg-purple-600', 'text-white');
                document.getElementById('searchTab').classList.remove('text-purple-600');
            } else if (tab === 'newInvoice') {
                document.getElementById('newInvoiceSection').classList.remove('hidden');
                document.getElementById('newInvoiceTab').classList.add('bg-purple-600', 'text-white');
                document.getElementById('newInvoiceTab').classList.remove('text-purple-600');
            } else if (tab === 'reports') {
                document.getElementById('reportsSection').classList.remove('hidden');
                document.getElementById('reportsTab').classList.add('bg-purple-600', 'text-white');
                document.getElementById('reportsTab').classList.remove('text-purple-600');
                initializeReports();
            }
        }

        function searchInvoices() {
            const billNo = document.getElementById('billNoSearch').value.toLowerCase();
            const customerName = document.getElementById('customerNameSearch').value.toLowerCase();
            const phone = document.getElementById('phoneSearch').value;

            const results = invoices.filter(invoice => {
                return (billNo === '' || invoice.id.toLowerCase().includes(billNo)) &&
                       (customerName === '' || invoice.customerName.toLowerCase().includes(customerName)) &&
                       (phone === '' || invoice.phone.includes(phone));
            });

            displaySearchResults(results);
        }

        function showAllInvoices() {
            displaySearchResults(invoices);
        }

        function displaySearchResults(results) {
            const resultsDiv = document.getElementById('searchResults');
            const listDiv = document.getElementById('searchResultsList');

            if (results.length === 0) {
                listDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No invoices found matching your search criteria.</p>';
            } else {
                listDiv.innerHTML = results.map(invoice => `
                    <div class="border border-gray-200 rounded-lg p-4 mb-4 hover:shadow-md transition-shadow cursor-pointer" onclick="showInvoiceDetails('${invoice.id}')">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="font-semibold text-lg text-purple-700">${invoice.id}</h4>
                                <p class="text-gray-600">${invoice.customerName} â€¢ ${invoice.phone}</p>
                                <p class="text-sm text-gray-500">${invoice.date}</p>
                                <div class="flex gap-2 mt-2">
                                    <span class="px-2 py-1 text-xs rounded-full ${invoice.type === 'purchase' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">
                                        ${invoice.type === 'purchase' ? 'Purchase' : 'Order'}
                                    </span>
                                    ${invoice.type === 'order' ? `<span class="px-2 py-1 text-xs rounded-full ${invoice.orderStatus === 'ready' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                                        ${invoice.orderStatus === 'ready' ? 'Ready' : 'Pending'}
                                    </span>` : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="status-${invoice.status} text-white px-3 py-1 rounded-full text-sm font-medium mb-2">
                                    ${getStatusText(invoice.status)}
                                </div>
                                <p class="font-semibold">â‚¹${invoice.subtotal.toFixed(2)}</p>
                                <p class="text-sm text-gray-600">Paid: â‚¹${invoice.amountPaid.toFixed(2)}</p>
                                ${invoice.balance !== 0 ? `<p class="text-sm font-medium ${invoice.balance > 0 ? 'text-red-600' : 'text-blue-600'}">
                                    ${invoice.balance > 0 ? 'Pending: â‚¹' + invoice.balance.toFixed(2) : 'Excess: â‚¹' + Math.abs(invoice.balance).toFixed(2)}
                                </p>` : ''}
                            </div>
                        </div>
                        <div class="text-sm text-gray-600 mb-3">
                            <strong>Items:</strong>
                            <ul class="mt-1">
                                ${invoice.items.map(item => `<li>â€¢ ${item.desc} - Qty: ${item.qty} Ã— â‚¹${item.price.toFixed(2)} = â‚¹${item.total.toFixed(2)}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="text-xs text-gray-500 bg-gray-50 p-2 rounded">
                            Click to view full invoice details
                        </div>
                    </div>
                `).join('');
            }

            resultsDiv.classList.remove('hidden');
        }

        function getStatusText(status) {
            switch(status) {
                case 'paid': return 'Fully Paid';
                case 'pending': return 'Pending Payment';
                case 'excess': return 'Excess Payment';
                default: return 'Unknown';
            }
        }

        function addItem() {
            const itemsDiv = document.getElementById('itemsList');
            const newItem = document.createElement('div');
            newItem.className = 'item-row grid grid-cols-12 gap-2 mb-2';
            newItem.innerHTML = `
                <input type="text" placeholder="Dress description" class="col-span-4 px-3 py-2 border border-gray-300 rounded-lg item-desc">
                <input type="number" placeholder="1" class="col-span-2 px-3 py-2 border border-gray-300 rounded-lg item-qty" value="1" onchange="calculateItemTotal(this)">
                <input type="number" placeholder="0.00" class="col-span-2 px-3 py-2 border border-gray-300 rounded-lg item-price" onchange="calculateItemTotal(this)">
                <input type="number" class="col-span-2 px-3 py-2 border border-gray-300 rounded-lg item-total bg-gray-50" readonly>
                <button onclick="removeItem(this)" class="col-span-2 bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-colors">Remove</button>
            `;
            itemsDiv.appendChild(newItem);
        }

        function removeItem(button) {
            button.parentElement.remove();
            calculateSubtotal();
        }

        function calculateItemTotal(input) {
            const row = input.parentElement;
            const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
            const price = parseFloat(row.querySelector('.item-price').value) || 0;
            const total = qty * price;
            row.querySelector('.item-total').value = total.toFixed(2);
            calculateSubtotal();
        }

        function calculateSubtotal() {
            const totals = document.querySelectorAll('.item-total');
            let subtotal = 0;
            totals.forEach(total => {
                subtotal += parseFloat(total.value) || 0;
            });
            document.getElementById('subtotal').value = subtotal.toFixed(2);
            calculateBalance();
        }

        function calculateBalance() {
            const subtotal = parseFloat(document.getElementById('subtotal').value) || 0;
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const balance = subtotal - amountPaid;
            document.getElementById('balance').value = balance.toFixed(2);
        }

        function saveInvoice() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const subtotal = parseFloat(document.getElementById('subtotal').value) || 0;
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const balance = parseFloat(document.getElementById('balance').value) || 0;
            const invoiceType = document.querySelector('input[name="invoiceType"]:checked').value;

            if (!customerName || !customerPhone || subtotal === 0) {
                alert('Please fill in all required fields and add at least one item.');
                return;
            }

            const items = [];
            document.querySelectorAll('.item-row').forEach(row => {
                const desc = row.querySelector('.item-desc').value;
                const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const total = parseFloat(row.querySelector('.item-total').value) || 0;
                
                if (desc && qty > 0 && price > 0) {
                    items.push({ desc, qty, price, total });
                }
            });

            let status = 'paid';
            if (balance > 0) status = 'pending';
            else if (balance < 0) status = 'excess';

            const newInvoice = {
                id: `INV${String(currentInvoiceId).padStart(3, '0')}`,
                customerName,
                phone: customerPhone,
                date: new Date().toISOString().split('T')[0],
                type: invoiceType,
                items,
                subtotal,
                amountPaid,
                balance,
                status
            };

            if (invoiceType === 'order') {
                newInvoice.orderStatus = 'pending';
            }

            invoices.push(newInvoice);
            currentInvoiceId++;

            // Clear form
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('subtotal').value = '';
            document.getElementById('amountPaid').value = '';
            document.getElementById('balance').value = '';
            document.getElementById('typePurchase').checked = true;
            
            // Reset items to one row
            const itemsList = document.getElementById('itemsList');
            const itemRows = itemsList.querySelectorAll('.item-row');
            itemRows.forEach((row, index) => {
                if (index === 0) {
                    row.querySelectorAll('input').forEach(input => input.value = '');
                    row.querySelector('.item-qty').value = '1';
                } else {
                    row.remove();
                }
            });

            alert(`Invoice ${newInvoice.id} saved successfully!`);
        }

        function saveAndPrintInvoice() {
            const customerName = document.getElementById('customerName').value;
            const customerPhone = document.getElementById('customerPhone').value;
            const subtotal = parseFloat(document.getElementById('subtotal').value) || 0;
            const amountPaid = parseFloat(document.getElementById('amountPaid').value) || 0;
            const balance = parseFloat(document.getElementById('balance').value) || 0;
            const invoiceType = document.querySelector('input[name="invoiceType"]:checked').value;

            if (!customerName || !customerPhone || subtotal === 0) {
                alert('Please fill in all required fields and add at least one item.');
                return;
            }

            const items = [];
            document.querySelectorAll('.item-row').forEach(row => {
                const desc = row.querySelector('.item-desc').value;
                const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const total = parseFloat(row.querySelector('.item-total').value) || 0;
                
                if (desc && qty > 0 && price > 0) {
                    items.push({ desc, qty, price, total });
                }
            });

            let status = 'paid';
            if (balance > 0) status = 'pending';
            else if (balance < 0) status = 'excess';

            const newInvoice = {
                id: `INV${String(currentInvoiceId).padStart(3, '0')}`,
                customerName,
                phone: customerPhone,
                date: new Date().toISOString().split('T')[0],
                type: invoiceType,
                items,
                subtotal,
                amountPaid,
                balance,
                status
            };

            if (invoiceType === 'order') {
                newInvoice.orderStatus = 'pending';
            }

            invoices.push(newInvoice);
            currentInvoiceId++;

            // Show success message
            alert(`Invoice ${newInvoice.id} saved successfully!`);

            // Print the invoice
            printInvoice(newInvoice.id);

            // Clear form
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('subtotal').value = '';
            document.getElementById('amountPaid').value = '';
            document.getElementById('balance').value = '';
            document.getElementById('typePurchase').checked = true;
            
            // Reset items to one row
            const itemsList = document.getElementById('itemsList');
            const itemRows = itemsList.querySelectorAll('.item-row');
            itemRows.forEach((row, index) => {
                if (index === 0) {
                    row.querySelectorAll('input').forEach(input => input.value = '');
                    row.querySelector('.item-qty').value = '1';
                } else {
                    row.remove();
                }
            });
        }

        let currentModalInvoice = null;

        function showInvoiceDetails(invoiceId) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;

            currentModalInvoice = invoice;
            
            const modalContent = document.getElementById('invoiceModalContent');
            modalContent.innerHTML = `
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Invoice Information</h3>
                        <div class="space-y-2">
                            <p><strong>Invoice ID:</strong> ${invoice.id}</p>
                            <p><strong>Date:</strong> ${invoice.date}</p>
                            <p><strong>Type:</strong> <span class="px-2 py-1 text-xs rounded-full ${invoice.type === 'purchase' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'}">${invoice.type === 'purchase' ? 'Purchase' : 'Order'}</span></p>
                            <p><strong>Payment Status:</strong> <span class="status-${invoice.status} text-white px-2 py-1 rounded-full text-sm">${getStatusText(invoice.status)}</span></p>
                            ${invoice.type === 'order' ? `
                                <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                                    <p class="font-semibold text-gray-800 mb-3">Order Status Management:</p>
                                    <div class="mb-3">
                                        <span class="text-sm text-gray-600">Current Status: </span>
                                        <span class="px-3 py-1 text-sm rounded-full font-medium ${
                                            invoice.orderStatus === 'pending' ? 'bg-yellow-500 text-white' : 
                                            invoice.orderStatus === 'packed' ? 'bg-blue-500 text-white' : 
                                            'bg-green-500 text-white'
                                        }">
                                            ${invoice.orderStatus === 'pending' ? 'Pending' : invoice.orderStatus === 'packed' ? 'Packed' : 'Ready'}
                                        </span>
                                    </div>
                                    <div class="flex flex-wrap gap-2 mb-3">
                                        <button onclick="selectOrderStatus('${invoice.id}', 'pending')" class="px-4 py-2 text-sm rounded-lg font-medium transition-colors ${invoice.orderStatus === 'pending' ? 'bg-yellow-500 text-white cursor-default' : 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200 border border-yellow-300'}" id="status-pending-${invoice.id}">
                                            ðŸ“‹ Set Pending
                                        </button>
                                        <button onclick="selectOrderStatus('${invoice.id}', 'packed')" class="px-4 py-2 text-sm rounded-lg font-medium transition-colors ${invoice.orderStatus === 'packed' ? 'bg-blue-500 text-white cursor-default' : 'bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300'}" id="status-packed-${invoice.id}">
                                            ðŸ“¦ Mark Packed
                                        </button>
                                        <button onclick="selectOrderStatus('${invoice.id}', 'ready')" class="px-4 py-2 text-sm rounded-lg font-medium transition-colors ${invoice.orderStatus === 'ready' ? 'bg-green-500 text-white cursor-default' : 'bg-green-100 text-green-800 hover:bg-green-200 border border-green-300'}" id="status-ready-${invoice.id}">
                                            âœ… Mark Ready
                                        </button>
                                    </div>
                                    <div class="flex gap-2 items-center">
                                        <button onclick="saveOrderStatus('${invoice.id}')" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-medium" id="save-status-${invoice.id}" style="display: none;">
                                            ðŸ’¾ Save Status Update
                                        </button>
                                        <button onclick="cancelStatusUpdate('${invoice.id}')" class="px-4 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 transition-colors" id="cancel-status-${invoice.id}" style="display: none;">
                                            Cancel
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">Select a new status above, then click Save to confirm the update</p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Customer Information</h3>
                        <div class="space-y-2">
                            <p><strong>Name:</strong> ${invoice.customerName}</p>
                            <p><strong>Phone:</strong> ${invoice.phone}</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Items</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="border border-gray-300 px-4 py-2 text-left">Description</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center">Quantity</th>
                                    <th class="border border-gray-300 px-4 py-2 text-right">Price</th>
                                    <th class="border border-gray-300 px-4 py-2 text-right">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${invoice.items.map(item => `
                                    <tr>
                                        <td class="border border-gray-300 px-4 py-2">${item.desc}</td>
                                        <td class="border border-gray-300 px-4 py-2 text-center">${item.qty}</td>
                                        <td class="border border-gray-300 px-4 py-2 text-right">â‚¹${item.price.toFixed(2)}</td>
                                        <td class="border border-gray-300 px-4 py-2 text-right">â‚¹${item.total.toFixed(2)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-3 gap-4 bg-gray-50 p-4 rounded-lg">
                    <div class="text-center">
                        <p class="text-sm text-gray-600">Subtotal</p>
                        <p class="text-xl font-bold text-gray-800">â‚¹${invoice.subtotal.toFixed(2)}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600">Amount Paid</p>
                        <p class="text-xl font-bold text-green-600">â‚¹${invoice.amountPaid.toFixed(2)}</p>
                    </div>
                    <div class="text-center">
                        <p class="text-sm text-gray-600">Balance</p>
                        <p class="text-xl font-bold ${invoice.balance > 0 ? 'text-red-600' : invoice.balance < 0 ? 'text-blue-600' : 'text-gray-800'}">
                            â‚¹${invoice.balance.toFixed(2)}
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('invoiceModal').classList.remove('hidden');
        }

        function closeInvoiceModal() {
            document.getElementById('invoiceModal').classList.add('hidden');
            currentModalInvoice = null;
        }

        function printCurrentInvoice() {
            if (currentModalInvoice) {
                printInvoice(currentModalInvoice.id);
            }
        }

        let selectedStatus = {};

        function selectOrderStatus(invoiceId, newStatus) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice || invoice.type !== 'order') return;
            
            // Don't allow selecting the current status
            if (invoice.orderStatus === newStatus) return;
            
            // Store the selected status
            selectedStatus[invoiceId] = newStatus;
            
            // Update button appearances
            const buttons = ['pending', 'packed', 'ready'];
            buttons.forEach(status => {
                const button = document.getElementById(`status-${status}-${invoiceId}`);
                if (button) {
                    if (status === newStatus) {
                        // Highlight selected status
                        button.className = button.className.replace(/bg-\w+-\d+/g, '').replace(/text-\w+-\d+/g, '');
                        button.className += ' bg-purple-500 text-white border-2 border-purple-600';
                    } else if (status === invoice.orderStatus) {
                        // Keep current status styled normally
                        button.className = button.className.replace(/bg-purple-\d+|border-purple-\d+|border-2/g, '');
                        if (status === 'pending') {
                            button.className += ' bg-yellow-500 text-white cursor-default';
                        } else if (status === 'packed') {
                            button.className += ' bg-blue-500 text-white cursor-default';
                        } else {
                            button.className += ' bg-green-500 text-white cursor-default';
                        }
                    } else {
                        // Reset other buttons to default style
                        button.className = button.className.replace(/bg-purple-\d+|border-purple-\d+|border-2/g, '');
                        if (status === 'pending') {
                            button.className += ' bg-yellow-100 text-yellow-800 hover:bg-yellow-200 border border-yellow-300';
                        } else if (status === 'packed') {
                            button.className += ' bg-blue-100 text-blue-800 hover:bg-blue-200 border border-blue-300';
                        } else {
                            button.className += ' bg-green-100 text-green-800 hover:bg-green-200 border border-green-300';
                        }
                    }
                }
            });
            
            // Show save and cancel buttons
            document.getElementById(`save-status-${invoiceId}`).style.display = 'block';
            document.getElementById(`cancel-status-${invoiceId}`).style.display = 'block';
        }

        function saveOrderStatus(invoiceId) {
            const newStatus = selectedStatus[invoiceId];
            if (!newStatus) return;
            
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (invoice && invoice.type === 'order') {
                invoice.orderStatus = newStatus;
                
                // Show success message
                const statusText = newStatus === 'pending' ? 'Pending' : newStatus === 'packed' ? 'Packed' : 'Ready';
                alert(`Order ${invoiceId} status successfully updated to: ${statusText}`);
                
                // Clear selected status
                delete selectedStatus[invoiceId];
                
                // Refresh the modal content
                showInvoiceDetails(invoiceId);
                
                // If search results are visible, refresh them too
                const searchResults = document.getElementById('searchResults');
                if (!searchResults.classList.contains('hidden')) {
                    // Re-run the last search to refresh the display
                    const billNo = document.getElementById('billNoSearch').value;
                    const customerName = document.getElementById('customerNameSearch').value;
                    const phone = document.getElementById('phoneSearch').value;
                    
                    if (billNo || customerName || phone) {
                        searchInvoices();
                    } else {
                        showAllInvoices();
                    }
                }
            }
        }

        function cancelStatusUpdate(invoiceId) {
            // Clear selected status
            delete selectedStatus[invoiceId];
            
            // Refresh the modal to reset button states
            showInvoiceDetails(invoiceId);
        }

        function printInvoice(invoiceId) {
            const invoice = invoices.find(inv => inv.id === invoiceId);
            if (!invoice) return;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice ${invoice.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .invoice-details { margin-bottom: 20px; }
                        .customer-details { margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .total-row { font-weight: bold; }
                        .status { padding: 5px 10px; border-radius: 15px; color: white; display: inline-block; }
                        .status-paid { background-color: #10b981; }
                        .status-pending { background-color: #f59e0b; }
                        .status-excess { background-color: #3b82f6; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Elegant Dress Shop</h1>
                        <h2>INVOICE</h2>
                    </div>
                    
                    <div class="invoice-details">
                        <p><strong>Invoice ID:</strong> ${invoice.id}</p>
                        <p><strong>Date:</strong> ${invoice.date}</p>
                        <p><strong>Status:</strong> <span class="status status-${invoice.status}">${getStatusText(invoice.status)}</span></p>
                    </div>
                    
                    <div class="customer-details">
                        <h3>Bill To:</h3>
                        <p><strong>${invoice.customerName}</strong></p>
                        <p>Phone: ${invoice.phone}</p>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${invoice.items.map(item => `
                                <tr>
                                    <td>${item.desc}</td>
                                    <td>${item.qty}</td>
                                    <td>â‚¹${item.price.toFixed(2)}</td>
                                    <td>â‚¹${item.total.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="text-align: right;">
                        <p><strong>Subtotal: â‚¹${invoice.subtotal.toFixed(2)}</strong></p>
                        <p><strong>Amount Paid: â‚¹${invoice.amountPaid.toFixed(2)}</strong></p>
                        <p><strong>Balance: â‚¹${invoice.balance.toFixed(2)}</strong></p>
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center; color: #666;">
                        <p>Thank you for your business!</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function initializeReports() {
            // Set default date range (current month)
            const now = new Date();
            const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);
            const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            
            document.getElementById('startDate').value = firstDay.toISOString().split('T')[0];
            document.getElementById('endDate').value = lastDay.toISOString().split('T')[0];
            
            generateReport();
        }

        function generateReport() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) {
                alert('Please select both start and end dates.');
                return;
            }
            
            // Filter invoices by date range
            const filteredInvoices = invoices.filter(invoice => {
                const invoiceDate = new Date(invoice.date);
                const start = new Date(startDate);
                const end = new Date(endDate);
                return invoiceDate >= start && invoiceDate <= end;
            });
            
            // Calculate summary statistics
            const totalSales = filteredInvoices.reduce((sum, inv) => sum + inv.subtotal, 0);
            const totalInvoices = filteredInvoices.length;
            const pendingAmount = filteredInvoices.filter(inv => inv.status === 'pending').reduce((sum, inv) => sum + inv.balance, 0);
            const avgInvoice = totalInvoices > 0 ? totalSales / totalInvoices : 0;
            
            // Update summary cards
            document.getElementById('totalSales').textContent = `â‚¹${totalSales.toFixed(2)}`;
            document.getElementById('totalInvoices').textContent = totalInvoices;
            document.getElementById('pendingAmount').textContent = `â‚¹${pendingAmount.toFixed(2)}`;
            document.getElementById('avgInvoice').textContent = `â‚¹${avgInvoice.toFixed(2)}`;
            
            // Generate detailed table
            const tableBody = document.getElementById('reportTableBody');
            tableBody.innerHTML = filteredInvoices.map(invoice => `
                <tr>
                    <td class="border border-gray-300 px-4 py-2">${invoice.id}</td>
                    <td class="border border-gray-300 px-4 py-2">${invoice.date}</td>
                    <td class="border border-gray-300 px-4 py-2">${invoice.customerName}</td>
                    <td class="border border-gray-300 px-4 py-2">${invoice.phone}</td>
                    <td class="border border-gray-300 px-4 py-2 text-right">â‚¹${invoice.subtotal.toFixed(2)}</td>
                    <td class="border border-gray-300 px-4 py-2 text-right">â‚¹${invoice.amountPaid.toFixed(2)}</td>
                    <td class="border border-gray-300 px-4 py-2 text-right ${invoice.balance > 0 ? 'text-red-600' : invoice.balance < 0 ? 'text-blue-600' : ''}">â‚¹${invoice.balance.toFixed(2)}</td>
                    <td class="border border-gray-300 px-4 py-2 text-center">
                        <span class="status-${invoice.status} text-white px-2 py-1 rounded-full text-xs">${getStatusText(invoice.status)}</span>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('reportDetails').classList.remove('hidden');
        }

        function printReport() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const totalSales = document.getElementById('totalSales').textContent;
            const totalInvoices = document.getElementById('totalInvoices').textContent;
            const pendingAmount = document.getElementById('pendingAmount').textContent;
            const avgInvoice = document.getElementById('avgInvoice').textContent;
            
            const tableBody = document.getElementById('reportTableBody').innerHTML;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Business Report - ${startDate} to ${endDate}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .summary { display: flex; justify-content: space-around; margin-bottom: 30px; }
                        .summary-card { text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; }
                        .status-paid { background-color: #10b981; }
                        .status-pending { background-color: #f59e0b; }
                        .status-excess { background-color: #3b82f6; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Elegant Dress Shop</h1>
                        <h2>Business Report</h2>
                        <p>Period: ${startDate} to ${endDate}</p>
                    </div>
                    
                    <div class="summary">
                        <div class="summary-card">
                            <h3>Total Sales</h3>
                            <p><strong>${totalSales}</strong></p>
                        </div>
                        <div class="summary-card">
                            <h3>Total Invoices</h3>
                            <p><strong>${totalInvoices}</strong></p>
                        </div>
                        <div class="summary-card">
                            <h3>Pending Amount</h3>
                            <p><strong>${pendingAmount}</strong></p>
                        </div>
                        <div class="summary-card">
                            <h3>Avg Invoice Value</h3>
                            <p><strong>${avgInvoice}</strong></p>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Phone</th>
                                <th>Amount</th>
                                <th>Paid</th>
                                <th>Balance</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${tableBody}
                        </tbody>
                    </table>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Initialize with search tab
        switchTab('search');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9937f3c777d7802e',t:'MTc2MTI5Mjk1MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
